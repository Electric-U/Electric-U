<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<style>
		img, .shadow { box-shadow: 0 10px 16px 0 rgba(0,0,0,0.2),0 3px 4px 0 rgba(0,0,0,0.19) !important;}
		.bg-warning {text-shadow: 0 0 12px #CDCDCD; } 
		h4 { cursor: pointer; }
	</style>
    <title>It's Movie Time</title>
  </head>
  <body class="bg-light">
    <div class="container-fluid pt-5 pb-5 pr-5 pl-5">
		<div class="align-left mx-auto px-0 pt-3 pb-3" style="width: 96%; max-width: 960px">
			<form>
				<input class="border shadow w-100 p-2 mx-0" type="text" placeholder="Search movies..." />
			</form>
		</div>
		<div class="align-left mx-auto px-0 pt-3 pb-3" style="width: 96%; max-width: 960px">		
			<h4 class="shadow bg-white text-center p-1 text-uppercase">Theater One</h4>
			<h4 class="shadow text-white bg-warning text-center p-1 text-uppercase">Theater Two</h4>
		</div>
		<div class="theatre align-left mx-auto px-0 pt-3 pb-3" style="width: 96%; max-width: 960px">
			
		</div>
		<div id="listing" class="listing mx-auto border border-dark bg-white pt-3 pb-3" style="width: 96%; max-width: 960px">
			<div class="row justify-content-center mx-sm-0 mx-5 px-0">
				<div class="col1 col-xs-12 col-sm-3 col-m-2">
					<img class="poster img-fluid mb-4" src="http://ondemo.tmsimg.com/assets/p14551155_v_v5_aa.jpg" />
				</div>
				<div class="col2 col-xs-12 col-sm-9 col-m-10 align-self-center">
					<h4>Isle of Dogs <small>PG-13</small></h4>
					<span>10:00 pm</span>
					<span>10:00 pm</span>
					<span>10:00 pm</span>
				</div>
			</div>
			
			<div class="row justify-content-center mx-sm-0 mx-5 px-0">
				<div class="col1 col-xs-12 col-sm-3 col-m-2">
					<img class="poster img-fluid mb-4" src="http://ondemo.tmsimg.com/assets/p14551155_v_v5_aa.jpg" />
				</div>
				<div class="col2 col-xs-12 col-sm-9 col-m-10 align-self-center">
					<h4>Isle of Dogs <small>PG-13</small></h4>
					<span>10:00 pm</span>
					<span>10:00 pm</span>
					<span>10:00 pm</span>
				</div>
			</div>
			
			<div class="row justify-content-center mx-sm-0 mx-5 px-0">
				<div class="col1 col-xs-12 col-sm-3 col-m-2">
					<img class="poster img-fluid mb-4" src="http://ondemo.tmsimg.com/assets/p14551155_v_v5_aa.jpg" />
				</div>
				<div class="col2 col-xs-12 col-sm-9 col-m-10 align-self-center">
					<h4>Isle of Dogs <small>PG-13</small></h4>
					<span>10:00 pm</span>
					<span>10:00 pm</span>
					<span>10:00 pm</span>
				</div>
			</div>

			<div class="row justify-content-center mx-sm-0 mx-5 px-0">
				<div class="col1 col-xs-12 col-sm-3 col-m-2">
					<img class="poster img-fluid mb-4" src="http://ondemo.tmsimg.com/assets/p14551155_v_v5_aa.jpg" />
				</div>
				<div class="col2 col-xs-12 col-sm-9 col-m-10 align-self-center">
					<h4>Isle of Dogs <small>PG-13</small></h4>
					<span>10:00 pm</span>
					<span>10:00 pm</span>
					<span>10:00 pm</span>
				</div>
			</div>

			<div class="row justify-content-center mx-sm-0 mx-5 px-0">
				<div class="col1 col-xs-12 col-sm-3 col-m-2">
					<img class="poster img-fluid mb-4" src="http://ondemo.tmsimg.com/assets/p14551155_v_v5_aa.jpg" />
				</div>
				<div class="col2 col-xs-12 col-sm-9 col-m-10 align-self-center">
					<h4>Isle of Dogs <small>PG-13</small></h4>
					<span>10:00 pm</span>
					<span>10:00 pm</span>
					<span>10:00 pm</span>
				</div>
			</div>			
			
		</div>
	</div>
	
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	<script src="https://d3js.org/d3.v5.min.js"></script>

	
	<script>
	
	/** API data attributes
	- title 
	- shotimes
		- dateTime
		- theatre
			- name
		- ticketURI
	- preferredImage
		- uri
	**/
	
	
	var rowClasses = "row justify-content-center mx-sm-0 mx-5 px-0";
	var col1Classes = "col1 col-xs-12 col-sm-3 col-m-2";
	var posterClasses = "poster img-fluid mb-4";
	var col2Classes = "col2 col-xs-12 col-sm-9 col-m-10 align-self-center";
	var titleClasses = "title"
	var ratingClasses ="rating text-secondary"; 
	var timesClasses ="times";
	var theatreOn = "shadow text-white bg-warning text-center p-1 text-uppercase";
	var theatreOff = "shadow bg-white text-center p-1 text-uppercase";
	

	var theatre = d3.select(".theatre").selectAll("h4").data([]);
	theatre.exit().remove();
	var fakeSelect = false;
	var d3Init = function () {
		theatre.data(MovieTime.getTheatres()).enter().append("h4")
			.classed(function(d) {var pick = fakeSelect ? theatreOff : theatreOn; fakeSelect = true; return pick;} , true)
			.text(function(d) {return d;});
	};

	var MovieTime = (function () { 
		var apiKey = 'q6mvywdsyebejxzgs6yd6cv4';
		var apiUrl = 'http://data.tmsapi.com/v1.1/movies/showings?jsonp=?';
		var imageDoamin = 'http://ondemo.tmsimg.com/';
		var zipCode = '90036';
		var theatres = [];
		var movieData = [];

		return {
			setZip: function(zip) { zipCode = zip; },
			getZip: function () { return zipCode; },
			getApiKey: function () { return apiKey; },
			getapiUrl: function() { return apiUrl; },
			getImageDomain: function () { return imageDomain; },
			getTheatres: function() { return theatres; } ,
			getMovieData: function () {return movieData; },
			loadData: function (d) { 
				movieData = d;
				movieData.forEach(function(d) { 
					d.showtimes.forEach(function(n) {
						var name = n.theatre.name;
						var add = theatres.filter(function (f) { return f == name; });
						if (add.length == 0) theatres.push(name);
					}.bind(this));
				}.bind(this));
				d3Init();
			},
		};
	})();
	
	$(document).ready(function() {
		
		$.getJSON( MovieTime.getapiUrl(), {
			startDate: '2018-04-04',
			zip: MovieTime.getZip(), 
			api_key: MovieTime.getApiKey()
		}).done(MovieTime.loadData).fail(function(a,b,c) { console.log(a,b,c);});
	});
	
	</script>
	
  </body>
</html>
